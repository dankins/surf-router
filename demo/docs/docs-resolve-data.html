<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-style/core-style.html">
<link rel="import" href="../../bower_components/surf-router/route-link.html">
<link rel="import" href="../../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../../bower_components/core-icon-button/core-icon-button.html">

<polymer-element name="docs-resolve-data">
    <template>
        <core-style ref="base"></core-style>
        <div class="content" unresolved transition="slide-left">
            <core-toolbar>
                <route-link state="docs.dynamicparameters"><core-icon-button icon="arrow-back"></core-icon-button></route-link>
                <span>Resolve Data</span>
                <span flex></span>
                <route-link state="docs.routelinks"><core-icon-button icon="arrow-forward"></core-icon-button></route-link>
            </core-toolbar>
            <div>
                <p>
                    Resolving data allows you to retrieve data before a state is activated.
                    Any data resolved from a parent state will be available to the child.
                    The state will look for a <i>resolve</i> property on the container and will then execute all of the functions contained therein.
                    The resulting values will be passed into the <i>initialize</i> function to allow you to use the them in the container.
                    For example, this page resolved the data seen below:
                </p>
                <div>
                    <strong>Current Date</strong> {{theTime}} <br/>
                    <strong>Resolved after 1s delay</strong> {{data.resolveB}}
                </div>
                <p>
                    All of the resolved data are wrapped as promises using the <a href="http://www.html5rocks.com/en/tutorials/es6/promises/">ES6-style promises</a>.
                    It is recommended to use this style of promises in your resolve objects.
                    An example is provided below:
                </p>
                <pre><code>
    resolve: {
        foo: function(params,data){
            return new Promise(function(resolve){
                this.async(function(){
                    resolve(-1);
                },null,1000)
            }.bind(this));

        },
        bar: function(){
            var srv = new ApiRequest("GET","/foo/bar/"+data.id)
            return srv.run(); // return a promise directly
        },
        baz: function(params,data){
            return -1; // you can return the value directly instead of a promise if you prefer
        }
    },
    init: function(data){
         this.id = data.id;
         this.foo = data.foo;
         this.bar = data.bar;
         this.baz = data.baz;
    }
                </code></pre>

                <p>
                    The default value for a state's <i>resolve</i> property is "container".
                    This indicates that the state will look for a "resolve" property in the container element.
                    If the <i>resolve</i> property is an object it will resolve the data in the context of the container.
                    After the resolves are complete the "init" function will be run with the URL parameters and resolved data passed in.
                    By default it will look for a function named "init" but this can be overridden with the "initialize" property in the route parameter.
                </p>
                <p>Example routes object:</p>
                <pre><code>
    Polymer({
        routes: {
            url: "", // HTML5 mode
            container: "app-body",
            imports: "app-body.html",
            resolve: "container", // this is optional - container is the default
            children: {
                foo: {
                    url: "/foo", // this is an abstract state that does not display anything other than its children
                    resolve: { // example of an inline resolve instead of from container's resolve property
                        foo: {
                            return "foovalue";
                        }
                    }
                    children: {
                        bar: { // complete state is foo.bar
                            url: "/bar" // complete url is /foo/bar
                            initialize: function(params,data){ // this could instead be run under the container if the property was a string instead of function
                                console.log(data) // should output foovalue, and whatever was resolved in "bar"
                            }
                        }
                    }
                }

            }
        }
    })

                </code></pre>
            </div>
        </div>

    </template>
    <script>
        Polymer({
            resolve: {
                theTime: function(){
                    var currentdate = new Date();
                    return currentdate.getDate() + "/"
                            + (currentdate.getMonth()+1)  + "/"
                            + currentdate.getFullYear() + " @ "
                            + currentdate.getHours() + ":"
                            + currentdate.getMinutes() + ":"
                            + currentdate.getSeconds();

                },
                resolveB: function(params,data){
                    logger.log("DEMO","starting to resolve 'resolveB'");
                    return new Promise(function(resolve){
                        this.async(function(){
                            var currentdate = new Date();
                            logger.log("DEMO","completed resolve 'resolveB'");
                            var rtn = currentdate.getDate() + "/"
                                    + (currentdate.getMonth()+1)  + "/"
                                    + currentdate.getFullYear() + " @ "
                                    + currentdate.getHours() + ":"
                                    + currentdate.getMinutes() + ":"
                                    + currentdate.getSeconds();
                            resolve(rtn);
                        },null,1000)
                    }.bind(this));
                }
            },
            init: function(params,data){
                this.theTime = data.theTime;
            }
        })
    </script>
</polymer-element>